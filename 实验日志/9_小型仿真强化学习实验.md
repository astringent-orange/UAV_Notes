---
date: 2026-01-28
---

尝试完成一个微型实验，在Ubuntu 20.04 + ROS noetic的环境中，使用PX4 firmware + mavros + gazebo，GPU nvidia rtx 2060 6G + CPU intel i7-10875H实现一个RL的过程。输入为64×64深度图像，输出为水平速度（高度固定）+ 旋转速度。模型选择基本的CNN处理图像后获得特征向量，与无人机状态向量进行拼接，经过MLP后输出。

# 环境搭建
构建工作空间，并安装PX4、配置gazebo模型、运行mavros通信。

**问题**
以前下载过PX4 firmware且配置过bashrc文件，这次尝试运行时发现，如果`source ./devel/setup.bash`之后则会找不到px4，再去`source ~/.bashrc`则会找不到功能包。
原因是两次source的内容互相覆盖了。解决方法一是修改`./devel/setup.bash`的内容，在其中加入px4的路径（不推荐修改bashrc文件）；解决方法二，单独为该项目安装一个px4固件。-->相当于增加了一个controller文件夹

```bash
cd catkin_ws
git clone --recursive https://github.com/PX4/PX4-Autopilot.git -b v1.13.3

cd PX4-Autopilot
# 安装依赖 (如果你之前装过可能不需要，但为了保险跑一下)  
bash ./Tools/setup/ubuntu.sh 
# 编译仿真环境 (这一步会生成 Gazebo 插件) 
DONT_RUN=1 make px4_sitl_default gazebo
```
然后需要构建一个完整的启动脚本
```bash
cd ~/catkin_ws
gedit setup_env.bash
```

```bash
#!/bin/bash

# 1. 获取当前脚本所在的目录 
# 这一步保证了不管你把项目拷到哪，路径都是对的
PROJECT_ROOT="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PX4_DIR="$PROJECT_ROOT/PX4-Autopilot"

# 2. Source Catkin 工作空间
source $PROJECT_ROOT/devel/setup.bash

# 3. 配置 PX4 环境
# 加载 PX4 的 gazebo 设置
source $PX4_DIR/Tools/setup_gazebo.bash $PX4_DIR $PX4_DIR/build/px4_sitl_default

# 4. 强制路径融合 (解决 ROS 和 PX4 打架的问题)
# 我们把 本地PX4路径 和 本地src路径 显式地加进去
export ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:$PX4_DIR:$PX4_DIR/Tools/sitl_gazebo:$PROJECT_ROOT/src

# 5. 设置 GAZEBO 模型路径 (防止找不到模型)
export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:$PX4_DIR/Tools/sitl_gazebo/models

echo "================================================="
echo "✅ Project Environment Loaded!"
echo "   - Workspace: $PROJECT_ROOT"
echo "   - PX4 Path:  $PX4_DIR"
echo "================================================="
```


# 基础通信与控制

image_transport
cv_bridge

